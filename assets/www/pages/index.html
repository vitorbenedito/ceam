<!DOCTYPE HTML>
<html>
<head>
<title>Controle de Estoque Avan&ccedil;ado Mobile</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
	
	<script type="text/javascript" charset="utf-8" src="../js/cordova-1.8.1.js"></script>


	<link rel="stylesheet" href="../css/jquery.mobile-1.1.0.css" /> 
	<script src="../js/jquery-1.7.2.js"></script> 
	<script src="../js/jquery.mobile-1.1.0.js"></script>
	<script src="../js/barcodescanner.js"></script>
	
	<script type="text/javascript">
	
	function carregaLocalizacoes(){
		
		$.getJSON('http://ceam.herokuapp.com/localizacaos.json', 
	  			function(data) {

	  			    var list = $('#list');
	  			    list.html("");
	  				$.each(data, function(key, val) {
	  				    
	    				 list.append(
	      				  $(document.createElement('li')).html(val.descricao)
	    				);
	    				
	  				});
	  				
	  				list.listview("destroy").listview()

				});
		
	}
	
	function carregarComboLocalizacao(){
		

		    $.getJSON('http://ceam.herokuapp.com/localizacaos.json', 
	  			function(data) {
					
			 		 var combo = $('#comboLocalizacao');
					 var combos = "";
		             $.each(data, function(key, val){
		            	combos = combos + "<option value='" + val.id + "' >" + val.descricao + "</option>";
		            }); 

		            combo.append(combos);
		            combo.selectmenu('refresh');

				}); 
		
	}
	
	function cadastrarLocalizacao(){
		
		// Pega o valor dos inputs
		 var desc = $('#descricao').val();
		
	
		 $.post('http://ceam.herokuapp.com/localizacaos', {"localizacao[descricao]": desc}, function(data){
		   /* alert(data) */
		   		
			 carregaLocalizacoes();
		   
		   },"html"
		  ); // Fim do POST
		
	}
	
	function scanear(){
		
		 window.plugins.barcodeScanner.scan( function(result) { 

			$.getJSON('https://www.vpsa.com.br/estoque/rest/externo/showroom/1/produtos/'+result.text, 
		  	function(data) {
				var list = $('#listCodigos');

				list.append(
		      			  $(document.createElement('li')).html(data.descricao)
		    	);
				
				list.listview("destroy").listview()
				
			});
	        
	     }, function(error) {
	        alert("Scanning failed: " + error);
	    }
		); 
		
	}
	
	$( function() {
		
		$('#buttonLocaliza').click(function() {
			carregaLocalizacoes();
		});
		
		$('#buttonScanner').click(function() {
			carregarComboLocalizacao();
		});
		
		$('#cadastrar').click(function(){
			cadastrarLocalizacao();
		});
		
		$('#scannerButton').click(function(){
			scanear();
		});
  	    
	} );
	
	</script>  
  
</head>
<body >

 	<div data-role="page" id="home"> 
 
	  <div data-role="header"> 
	    <h1>CEAM</h1> 
	  </div> 
 
	  <div data-role="content" id="content">
	  
	    <p><a href="#localizacoes"  data-role="button" id="buttonLocaliza" data-back="true" data-transition="slide">Cadastro de Localidades</a></p>  
	    <p><a href="#scanner" data-role="button" id="buttonScanner" data-back="true" data-transition="slide">Organizar Estoque</a></p>  
	    <p><a href="#linkPesquisaMercadorias" data-role="button">Pesquisa de Mercadorias</a></p>
	   
	  </div> 
	  
	 </div>
	  
	  <div data-role="page" id="localizacoes">
	  
	  	<div data-role="header"> 
	    	<h1>CEAM</h1> 
	    	<div class="ui-body ui-body-b" align="center"> 
	    		<input type="text" name="descricao" id="descricao" value="" placeholder="Descrição"/> 
	    		<br/>
		     	<a id="cadastrar" data-role="button" data-theme="b" data-icon="plus" >Adicionar</a>
	    	</div>
	  	</div> 
	  
	     <div data-role="content">
	     	<ul data-role="listview" id="list"> 
      
    		</ul> 
	 	 </div> 
	  </div>
	  
	  <div data-role="page" id="scanner">
	  
	  	<div data-role="header"> 
	    	<h1>CEAM</h1> 
	    	<div class="ui-body ui-body-b"  align="center"> 
		     	<a id="scannerButton" data-role="button" data-theme="b" data-icon="plus" data-inline="true">Escanear</a> 
		     	<a id="salvarOrganizacao" data-role="button" data-theme="b" data-icon="check" data-inline="true">Salvar</a> 
	    	</div>
	  	</div> 
	  	<div data-role="fieldcontain">
				<select name=comboLocalizacao id="comboLocalizacao" data-native-menu="false">
					
				</select>
			</div>
	     <div data-role="content">
	     	<div>
	     		<ul data-role="listview" id="listCodigos"> 
      
    			</ul>
    		</div>
    		
	 	 </div> 
	  </div>


 
</body>
</html>